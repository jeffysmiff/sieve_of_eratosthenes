<!DOCTYPE html>
<head>
	<style type="text/css">
		.container {
            display: grid;
            repeat(3, 1fr);
            grid-gap: 50px;
            justify-content: center;
            grid-auto-flow: column;
        }
        .box {
            height: 400px;
        }
	</style>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function baseName(str) {
            var base = new String(str).substring(str.lastIndexOf('/') + 1); 
            if(base.lastIndexOf(".") != -1)       
                base = base.substring(0, base.lastIndexOf("."));
            return base;
        }

        $( document ).ready(function() {
            var filenames = [
                "python.json",
                "node.json",
                "java.json",
                "c.json",
                "cplusplus.json"
            ];
            var charts = {
                "myChart100" : undefined,
                "myChart1000" : undefined,
                "myChart10000" : undefined,
                "myChart100000" : undefined,
                "myChart1000000" : undefined,
            }
            // initialise the charts with empty data
            for(const [key,value] of Object.entries(charts)) {
                let chartCtx = $('#' + key)[0].getContext('2d');
                charts[key] = new Chart(chartCtx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: [],
                            data: [],
                            backgroundColor: [
                            ],
                            borderColor: [
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Elapsed time (\u00b5s)'
                                },
                                beginAtZero: true
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Language'
                                }
                            }
                        },
                        datasets: {
                            bar: {
                                label: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            display: true,
                            title: {
                                text: 'Elapsed time to calc primes under ' + key.substring(7),
                                display: true,
                                align: 'center',
                                font: {
                                    family: 'Helvetica',
                                    size: 18
                                }
                            },
                            legend: {
                                labels: {
                                    display: false,
                                    boxWidth: 0
                                }
                            }
                        }
                    }
                });
            }
            console.log(filenames);
            let count = 1;
            for( let filename of filenames ) {
                let nodeRes = undefined;
                let basename = baseName(filename);
                $.when(
                    $.getJSON(filename, function(data){
                        nodeRes = data;
                    })
                ).then(function() {
                    let language = Object.keys(nodeRes)[0];
                    // Set up the colourbars - hard coded for each language
                    let red = 0;
                    let blue = 0;
                    let green = 0;
                    switch(language) {
                        case "node":
                            // Red
                            red = 255;
                            green = 0;
                            blue = 0;
                            break;
                        case "python":
                            // Green
                            red = 0;
                            green = 255;
                            blue = 0;
                            break;
                        case "java":
                            // Blue
                            red = 0;
                            green = 0;
                            blue = 255;
                            break;
                        case "c":
                            // Magenta
                            red = 255;
                            green = 0;
                            blue = 255;
                            break;
                        default:
                            red = 0;
                            green = 0;
                            blue = 0;
                            break;
                    }
                    for(const [primeMax,primeRes] of Object.entries(nodeRes[language])) {
                        let chartName = "myChart" + primeMax;
                        charts[chartName].data.labels.push(language);
                        charts[chartName].data.datasets[0].backgroundColor.push("rgba(" + red + ", " + green + ", " + blue + ", 0.6)");
                        charts[chartName].data.datasets[0].borderColor.push("rgba(" + red + ", " + green + ", " + blue + ", 0.2)");
                        charts[chartName].data.datasets[0].data.push(primeRes.duration);
                        charts[chartName].update();
                    }
                    count++;
                });
            }
        });
    </script>
</head>
<html>
	<body>
		<div class="container">
			<div class="box" id="chartContainer100">
                <canvas id="myChart100" width="320" height="320" class="chartcanvas"></canvas>
            </div>
			<div class="box" id="chartContainer1000">
                <canvas id="myChart1000" width="320" height="320" class="chartcanvas"></canvas>
            </div>
			<div class="box" id="chartContainer10000">
                <canvas id="myChart10000" width="320" height="320" class="chartcanvas"></canvas>
            </div>
        </div>
        <div class="container">
			<div class="box" id="chartContainer100000">
                <canvas id="myChart100000" width="320" height="320" class="chartcanvas"></canvas>
            </div>
			<div class="box" id="chartContainer1000000">
                <canvas id="myChart1000000" width="320" height="320" class="chartcanvas"></canvas>
            </div>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.0/dist/chart.min.js"></script>
	</body>
</html>